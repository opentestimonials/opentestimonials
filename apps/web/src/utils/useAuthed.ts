import { useSession } from 'next-auth/react';
import { useRouter } from 'next/router';
import { useEffect } from 'react';

export function useAuthed(props: { callbackUrl?: string }) {
  const session = useSession();
  const router = useRouter();

  useEffect(() => {
    if (session.status === 'unauthenticated') {
      const url = new URL('/login', window.origin);
      if (props.callbackUrl) {
        url.searchParams.set('callbackUrl', props.callbackUrl);
      }
      router.replace(url);
    }
  }, [session, props.callbackUrl]);
}
