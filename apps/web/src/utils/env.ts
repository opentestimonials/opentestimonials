import invariant from 'tiny-invariant';

const VARIABLE_NAMES = [
  'GITHUB_ID',
  'GITHUB_SECRET',
  'DATABASE_URL',
  'NEXTAUTH_SECRET',
  'SERVER_URL',
] as const;

export const ENV = new Map<typeof VARIABLE_NAMES[number], string>();

// overrides
const { SERVER_URL, VERCEL_URL } = process.env;
ENV.set(
  'SERVER_URL',
  SERVER_URL ??
    `https://${VERCEL_URL}` ??
    `http://localhost:${process.env.PORT ?? 3000}`
);

for (const variableName of VARIABLE_NAMES) {
  if (ENV.has(variableName)) {
    // skip overrides
    continue;
  }
  const value = process.env[variableName];
  invariant(value, `${variableName} is not set`);
  ENV.set(variableName, value);
}
