import AuthGuard from '@/components/AuthGuard';
import { Button } from '@/components/Button';
import Confetti from '@/components/Confetti';
import { GridSkeleton } from '@/components/dashboard/GridSkeletons';
import Nav from '@/components/dashboard/Nav';
import { FallbackSkeleton } from '@/components/FallbackSkeleton';
import ExpandableTestimonials from '@/components/opentestimonials/ExpandableTestimonials';
import { useTestimonials } from '@/components/opentestimonials/GridTestimonials';
import Head from 'next/head';
import { useRouter } from 'next/router';

export default function Success() {
  const router = useRouter();
  const subdomain = String(router.query.subdomain);
  const testimonials = useTestimonials({
    subdomain,
  });

  return (
    <>
      <AuthGuard callbackUrl={router.asPath} />
      <Head>
        <title>Setup Complete - Open Testimonials</title>
      </Head>
      <Nav
        breadcrumbs={{
          loading: !router.query.subdomain,
        }}
      />

      <div className="mx-auto w-full max-w-7xl p-4 pb-20 ">
        <div>
          <h1 className="text-center text-3xl font-semibold tracking-tight md:text-4xl">
            Congratulations!
          </h1>
          <p className="mt-8 text-center text-sm font-medium text-neutral-600">
            Your user testimonials are ready.
          </p>
          <div className="mt-8 flex w-full justify-center gap-4">
            <Button
              href={`/dashboard/${subdomain}?embed=true&appear=true`}
              color="pink"
            >
              Embed testimonials
            </Button>
            <Button href={`/dashboard/${subdomain}`} variant="outline">
              Go to dashboard
            </Button>
          </div>
        </div>
        <div className="mt-16 flex flex-col gap-8 md:flex-row">
          <div className="w-full rounded-lg border p-4 shadow-2xl">
            <FallbackSkeleton fallback={<GridSkeleton />}>
              {testimonials && (
                <ExpandableTestimonials collection={subdomain} />
              )}
            </FallbackSkeleton>
          </div>
        </div>
      </div>
      <Confetti
        options={{
          spread: 180,
          particleCount: 100,
          ticks: 400,
          gravity: 1.3,
          disableForReducedMotion: true,
          origin: { y: 0 },
        }}
      />
    </>
  );
}
